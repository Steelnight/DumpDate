version: '3.8'

services:
  cache-builder:
    build: .
    command: ["python", "build_cache.py"]
    volumes:
      - .:/app
    environment:
      - PYTHONUNBUFFERED=1

  bot:
    build: .
    depends_on:
      - cache-builder
    command: ["python", "run_bot.py"]
    volumes:
      - .:/app
    environment:
      - PYTHONUNBUFFERED=1
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}

  dashboard:
    build: .
    command: ["python", "run_dashboard.py"]
    ports:
      - "5000:5000"
    volumes:
      - .:/app
    environment:
      - PYTHONUNBUFFERED=1
      - FLASK_RUN_HOST=0.0.0.0
