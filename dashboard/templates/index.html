<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DumpDate Bot Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <meta http-equiv="refresh" content="60">
</head>
<body>
  <section class="section">
    <div class="container">
      <h1 class="title">
        DumpDate Bot Status Dashboard
      </h1>
      <p class="subtitle">
        Metrics automatically refresh every 60 seconds.
      </p>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <h2 class="title is-4">Key Performance Indicators</h2>
      <nav class="level is-mobile">
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Active Subscriptions</p>
            <p class="title">{{ kpis.active_subscriptions }}</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Unique Subscribed Addresses</p>
            <p class="title">{{ kpis.unique_addresses_subscribed }}</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Total Cached Addresses</p>
            <p class="title">{{ kpis.total_cached_addresses }}</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Bot Uptime (Hours)</p>
            <p class="title">{{ kpis.bot_uptime_hours }}</p>
          </div>
        </div>
      </nav>
      <nav class="level is-mobile">
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">DB Size (MB)</p>
            <p class="title">{{ kpis.db_size_mb }}</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Address DB Size (MB)</p>
            <p class="title">{{ kpis.address_db_size_mb }}</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">iCal Download Errors</p>
            <p class="title">{{ kpis.ical_download_errors }}</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
            <div>
              <p class="heading">Opt-out Rate</p>
              <p class="title">{{ kpis.opt_out_rate_percent }}%</p>
            </div>
          </div>
      </nav>
      <nav class="level is-mobile">
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Delivery Rate</p>
            <p class="title">{{ kpis.delivery_rate_percent }}%</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Failure Rate</p>
            <p class="title">{{ kpis.failure_rate_percent }}%</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
          <div>
            <p class="heading">Avg. Delivery Latency (s)</p>
            <p class="title">{{ kpis.avg_delivery_latency_seconds }}</p>
          </div>
        </div>
        <div class="level-item has-text-centered">
            <div>
              <p class="heading">&nbsp;</p>
              <p class="title">&nbsp;</p>
            </div>
        </div>
      </nav>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <h2 class="title is-4">System Logs</h2>
      <div class="table-container">
        <table class="table is-striped is-fullwidth">
          <thead>
            <tr>
              <th>Timestamp</th>
              <th>Level</th>
              <th>Logger</th>
              <th>Message</th>
            </tr>
          </thead>
          <tbody>
            {% for log in logs %}
            <tr>
              <td>{{ log.timestamp }}</td>
              <td>{{ log.level }}</td>
              <td>{{ log.logger_name }}</td>
              <td>{{ log.message }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </section>
</body>
</html>
